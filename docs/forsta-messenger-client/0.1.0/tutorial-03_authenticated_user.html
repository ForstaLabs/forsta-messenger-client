<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Tutorial: Authenticated User - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="forsta.messenger.Client.html">Client</a><ul class='methods'><li data-type='method'><a href="forsta.messenger.Client.html#addEventListener">addEventListener</a></li><li data-type='method'><a href="forsta.messenger.Client.html#navPanelToggle">navPanelToggle</a></li><li data-type='method'><a href="forsta.messenger.Client.html#removeEventListener">removeEventListener</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadArchive">threadArchive</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadDestroyMessages">threadDestroyMessages</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadEnsure">threadEnsure</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadExpunge">threadExpunge</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadGetAttribute">threadGetAttribute</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadList">threadList</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadListAttributes">threadListAttributes</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadMake">threadMake</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadOpen">threadOpen</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadRestore">threadRestore</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadSendControl">threadSendControl</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadSendMessage">threadSendMessage</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadSendUpdate">threadSendUpdate</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadSetAttribute">threadSetAttribute</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadSetExpiration">threadSetExpiration</a></li><li data-type='method'><a href="forsta.messenger.Client.html#threadStartWithExpression">threadStartWithExpression</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-ExchangePayload.html">ExchangePayload</a></li><li><a href="external-TagExpression.html">TagExpression</a></li></ul><h3>Events</h3><ul><li><a href="global.html#event:init">init</a></li><li><a href="global.html#event:loaded">loaded</a></li><li><a href="global.html#event:provisioningdone">provisioningdone</a></li><li><a href="global.html#event:provisioningerror">provisioningerror</a></li><li><a href="global.html#event:provisioningrequired">provisioningrequired</a></li><li><a href="global.html#event:thread-message">thread-message</a></li><li><a href="global.html#event:thread-message-readmark">thread-message-readmark</a></li></ul><h3>Namespaces</h3><ul><li><a href="forsta.html">forsta</a></li><li><a href="forsta.messenger.html">messenger</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-01_hello_world.html">Hello World</a></li><li><a href="tutorial-02_ephemeral_user.html">Ephemeral User</a></li><li><a href="tutorial-03_authenticated_user.html">Authenticated User</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: Authenticated User</h1>
    

    <section>

<header>
    

    <h2>Authenticated User</h2>
</header>

<article>
    <p>This tutorial assumes you have already followed:</p>
<ul>
<li><a href="tutorial-01_hello_world.html">Hello World Tutorial</a></li>
<li><a href="tutorial-02_ephemeral_user.html">Ephemeral User Tutorial</a></li>
</ul>
<p>Complete code for this tutorial is available at: <a href="https://github.com/ForstaLabs/forsta-messenger-client/tree/master/examples/authenticated_user">https://github.com/ForstaLabs/forsta-messenger-client/tree/master/examples/authenticated_user</a></p>
<p>In the last tutorial we configured the client to use an ephemeral user who is
created and logged in based on the org ephemeral token. However in production
systems we recommend creating Forsta users using the Forsta Atlas API and
libraries. In this tutorial we will discuss how to connect an authenticated user.</p>
<p>You can create a user using either:</p>
<ul>
<li><a href="https://app.forsta.io/people">Forsta Console</a></li>
<li><a href="https://atlas.forsta.io/doc/">Atlas API</a></li>
</ul>
<p>For a user to authenticate with the Forsta Messenger Client they need to provide
a Forsta generated JWT (JSON Web Token). In a production system JWTs are generated
by authenticating a user with a saved auth token. For testing purposes you can
also generate a JWT with the following shell scripts:</p>
<ul>
<li><a href="https://github.com/ForstaLabs/developer-examples/blob/master/scripts/get_jwt.sh">JWT Generator</a></li>
<li><a href="https://github.com/ForstaLabs/developer-examples/blob/master/scripts/forsta_library.sh">Required Forsta Script Library</a></li>
</ul>
<p>Once you have generated a jwt start with the following code that authenticates a user
in the Forsta Messenger Client:</p>
<pre class="prettyprint source lang-html"><code>&lt;html>
  &lt;head>
    &lt;script src=&quot;https://forstalabs.github.io/forsta-messenger-client/dist/forsta-messenger-client.min.js&quot;>&lt;/script>
  &lt;/head>

  &lt;body>
    &lt;!-- Div that contains the Forsta messenger client -->
    &lt;div id=&quot;my-messenger&quot; style=&quot;width: 80%; height: 80%; visibility: hidden;&quot;>&lt;/div>
  &lt;/body>

  &lt;script>
    function displayMessenger() {
      const messenger = document.getElementById(&quot;my-messenger&quot;);
      messenger.style.visibility = &quot;visible&quot;;
    }
    
    async function onLoaded(client) {
      threadId = await client.threadMake(&quot;@userinyourorg&quot;);
      await client.threadOpen(threadId);
      
      displayMessenger();
    }

    // Configure the Forsta messenger client to use the div with id my-messenger
    // And connect as an ephemeral user using the ephemeral chat token
    const myClient = new forsta.messenger.Client(document.getElementById('my-messenger'),
      { jwt: 'server generated jwt' },
      { onLoaded: onLoaded, showNav: true, showHeader: true });
  &lt;/script>
&lt;/html>

</code></pre>
<p>If you load this code for the first time in a browser you will discover that nothing displays.
This is because authenticated users on new systems must first provision their encryption keys.
The <code>onLoaded</code> function fires after provisioning. To display the messenger when provisioning is
required there are three provisioning listeners. Add the following functions to your script:</p>
<pre class="prettyprint source lang-html"><code>function onProvisioningRequired() {
  displayMessenger();
}

function onProvisioningError() {
  alert(&quot;Provisioning Failed!&quot;);
}

function onProvisioningDone() {
  alert(&quot;Provisioning Finished!&quot;);
}
</code></pre>
<p>Then after the <code>myClient =</code> line add the following to set the event listeners:</p>
<pre class="prettyprint source lang-html"><code>myClient.addEventListener('provisioningrequired', onProvisioningRequired);
myClient.addEventListener('provisioningerror', onProvisioningError);
myClient.addEventListener('provisioningdone', onProvisioningDone);
</code></pre>
<p>Now, try loading the page. The provisioning listener will trigger the messenger to display.
You have the option to either:</p>
<ul>
<li>Generate new keys</li>
<li>Import previous keys from a currently running client</li>
</ul>
<p>You can read more about the need to provision keys on the <a href="https://docs.forsta.io/docs/system-life-cycle">System Life Cycle page</a> of the Forsta docs.</p>
</article>

</section>

    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>

<link type="text/css" rel="stylesheet" href="../../css/jsdoc-overrides.css"/>
<link id="favicon" rel="shortcut icon" href="../../images/icon_256.png"/>
<script src="../../js/jsdoc-overrides.js"></script>