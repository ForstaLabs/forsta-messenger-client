!function(){"use strict";const e=self.ifrpc=self.ifrpc||{},s=2,t="*",r="ifrpc-magic-494581011";let i=0;e.RemoteError=class e extends Error{static serialize(e){return Object.assign({name:e.name,message:e.message,stack:e.stack},JSON.parse(JSON.stringify(e)))}static deserialize(e){const s=new this(`Remote error: <${e.name}: ${e.message}>`);return s.remoteError=e,s}};class n{constructor(e,i){i=i||{},this.peerFrame=e,this.magic=i.magic||r,this.peerOrigin=i.peerOrigin||t,this.commands=new Map,this.listeners=new Map,this.activeCommandRequests=new Map,self.addEventListener("message",async e=>{if(e.source!==this.peerFrame)return;if("*"!==this.peerOrigin&&e.origin!==this.peerOrigin)return void console.warn("Message from untrusted origin:",e.origin);const t=e.data;if(t&&t.magic===this.magic)if(t.version===s)if("command"===t.op)if("request"===t.dir)await this.handleCommandRequest(e);else{if("response"!==t.dir)throw new Error("Command Direction Missing");await this.handleCommandResponse(e)}else{
if("event"!==t.op)throw new Error("Invalid ifrpc Operation");await this.handleEvent(e)}else console.error(`Version mismatch: expected ${s} but got ${t.version}`);else console.error("Invalid ifrpc magic")}),this.addCommandHandler("ifrpc-get-commands",()=>Array.from(this.commands.keys())),this.addCommandHandler("ifrpc-get-listeners",()=>Array.from(this.listeners.keys()))}addCommandHandler(e,s){if(this.commands.has(e))throw new Error("Command handler already added: "+e);this.commands.set(e,s)}removeCommandHandler(e){this.commands.delete(e)}addEventListener(e,s){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s)}removeEventListener(e,s){const t=this.listeners.get(e).fitler(e=>e!==s);this.listeners.set(e,t)}triggerEvent(e){const s=Array.from(arguments).slice(1);this.sendMessage({op:"event",name:e,args:s})}async invokeCommand(e){const s=Array.from(arguments).slice(1),t=`${Date.now()}-${i++}`,r=new Promise((e,s)=>{this.activeCommandRequests.set(t,{resolve:e,reject:s
})});return this.sendMessage({op:"command",dir:"request",name:e,id:t,args:s}),await r}sendMessage(e){const t=Object.assign({magic:this.magic,version:s},e);this.peerFrame.postMessage(t,this.peerOrigin)}sendCommandResponse(e,s,t){this.sendMessage({op:"command",dir:"response",name:e.data.name,id:e.data.id,success:s,response:t})}async handleCommandRequest(s){const t=this.commands.get(s.data.name);if(!t){const t=new ReferenceError("Invalid Command: "+s.data.name);throw this.sendCommandResponse(s,!1,e.RemoteError.serialize(t)),t}try{this.sendCommandResponse(s,!0,await t.apply(s,s.data.args))}catch(t){this.sendCommandResponse(s,!1,e.RemoteError.serialize(t))}}async handleCommandResponse(s){const t=this.activeCommandRequests.get(s.data.id);if(!t)throw new Error("Invalid request ID");this.activeCommandRequests.delete(s.data.id),s.data.success?t.resolve(s.data.response):t.reject(e.RemoteError.deserialize(s.data.response))}async handleEvent(e){const s=this.listeners.get(e.data.name)
;if(s&&s.length)for(const t of s)try{await t.apply(e,e.data.args)}catch(e){console.error("ifrpc event listener error:",t,e)}else console.debug("ifrpc event triggered without listeners:",e.data.name)}}e.init=((e,s)=>new n(e,s))}(),self.forsta=self.forsta||{},forsta.messenger=forsta.messenger||{},function(){"use strict";forsta.messenger.Client=class e{constructor(e,s,t){if(!(e instanceof Element))throw new TypeError("el argument must be an Element");if(!s)throw new TypeError("auth argument missing");const r=new URLSearchParams;if(s.orgEphemeralToken)r.set("token",s.orgEphemeralToken);else{if(!s.userAuthToken)throw new TypeError("invalid auth value");r.set("userToken",s.userAuthToken)}t=t||{},this.callback=t.callback,this.url=t.url||"https://app.forsta.io/@embed",this._iframe=document.createElement("iframe"),this._iframe.style.border="0 solid transparent",this._iframe.style.width="100%",this._iframe.style.height="100%",this._iframe.addEventListener("load",()=>{
const e=this._iframe.contentWindow;this._rpc=ifrpc.init(this._iframe.contentWindow),this._rpc.addEventListener("init",this.onClientInit.bind(this))}),this._iframe.setAttribute("src",`${this.url}?${r}`),e.appendChild(this._iframe)}async onClientInit(){console.debug("client init"),this.callback&&this.callback(this)}}}();